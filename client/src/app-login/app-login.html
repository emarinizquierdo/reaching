<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<link rel="import" href="/bower_components/paper-fab/paper-fab.html">
<link rel="import" href="/bower_components/iron-icons/iron-icons.html">
<link rel="import" href="/bower_components/iron-icon/iron-icon.html">
<link rel="import" href="/bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="/bower_components/app-storage/app-indexeddb-mirror/app-indexeddb-mirror.html">
<link rel="import" href="/bower_components/note-app-elements/na-elements.html">
<link rel="import" href="/bower_components/polymerfire/firebase-app.html">
<link rel="import" href="/bower_components/polymerfire/firebase-auth.html">
<link rel="import" href="/bower_components/polymerfire/firebase-document.html">
<link rel="import" href="/bower_components/polymerfire/firebase-query.html">
<link rel="import" href="/bower_components/polymerfire/firebase-messaging.html">
<link rel="import" href="/bower_components/polymerfire/firebase-storage-script.html">
<link rel="import" href="/bower_components/geo-location/geo-location.html">
<link rel="import" href="/bower_components/google-map/google-map.html">

<dom-module id="note-app">
  <template>
    <style include="note-app-shared-styles"></style>

    <firebase-app
        name="geolocations"
        api-key="AIzaSyDMCn3uXGLQvA_D-qKKJlvaZosKittPnNs"
        auth-domain="reaching-981a5.firebaseapp.com"
        database-url="https://reaching-981a5.firebaseio.com/">
    </firebase-app>

{{signedIn}}

    <paper-icon-button
        icon="[[computeLockIcon(signedIn)]]"
        disabled="[[!signedIn]]"
        on-tap="signOut">
    </paper-icon-button>

    <paper-button on-tap="signIn" disabled="[[signedIn]]">
      <iron-icon icon="account-circle"></iron-icon>
      <span>Sign in with Google</span>
    </paper-button>

    <firebase-auth
        id="auth"
        app-name="geolocations"
        provider="google"
        signed-in="{{signedIn}}"
        user="{{user}}">
    </firebase-auth>

    <firebase-query
        id="query"
        app-name="geolocations"
        path="/geolocations/[[user.uid]]"
        data="{{data}}">
    </firebase-query>

    <app-indexeddb-mirror
        session="[[user.uid]]"
        key="geolocations"
        data="{{data}}"
        persisted-data="{{persistedData}}">
    </app-indexeddb-mirror>

    <div class="notes">
      <template is="dom-repeat" items="[[persistedData]]" as="geolocation">
        {{geolocation.$key}}
      {{geolocation.lat}}
      {{geolocation.long}}
      </template>
    </div>

    <firebase-document
        id="document"
        app-name="geolocations"
        path="/geolocations/[[user.uid]]/position"
        data="{{geoData}}">
    </firebase-document>

    <geo-location latitude="{{geoData.lat}}"
                   longitude="{{geoData.long}}" watch-pos high-accuracy on-geo-response="ongeo"></geo-location>
     <google-map latitude="[[geoData.lat]]" longitude="[[geoData.long]]">
       <google-map-marker latitude="[[geoData.lat]]" longitude="[[geoData.long]]"></google-map-marker>
     </google-map>

  </template>
  <script>
    (function() {
      'use strict';

      Polymer({
        is: 'note-app',

        get isEditable() {
          return this.online;
        },
        computeLockIcon: function(signedIn) {
          return signedIn ? 'lock-open' : 'lock';
        },
        lock: function() {
          this.fire('sign-out');
        },
        signIn: function() {
          this.$.auth.signInWithPopup();
        },
        signOut: function() {
          if (this.$.auth) {
            this.$.auth.signOut();
          }
        },

        ongeo: function(a,e){
          console.log(e.latitude);
          console.log(e.longitude);

            this.geoData = {
              lat : e.latitude,
              long : e.longitude
            };

        }
      });
    })();
  </script>
